import{r as n,j as e,H as S,b as g}from"./app-BELBKpes.js";import{A as L}from"./app-layout-ojULHhWj.js";import{S as j,a as f,b as w,c as y,d as v}from"./select-BDXi-NEG.js";/* empty css            */import"./button-nU1hvmlC.js";import"./index-C9QvDtcI.js";import"./index-DOwu2Jtr.js";import"./index-DMd68jTr.js";import"./x-Cq7ovUpJ.js";import"./index-BScKngJZ.js";import"./dropdown-menu-BFJBx4pO.js";import"./index-D6b3eXot.js";import"./mainLogo-CSczizqJ.js";import"./store-CJMaAY7C.js";import"./ticket-M12z_2rk.js";import"./index-C-18BN_Z.js";import"./check--f5c7lcj.js";function q({code:o,cards:t,loyalty_card_id:i}){const[h,d]=n.useState(!1),[c,u]=n.useState(!1),[l,x]=n.useState(i?.toString||t.length>0?t[0].id.toString():"");n.useEffect(()=>{i&&x(i.toString())},[i]);const[m,r]=n.useState(null),N=()=>{if(!l){r("Please select a loyalty card");return}d(!0),r(null),g.get("/business/issue-stamp",{loyalty_card_id:l}),d(!1)},k=()=>{if(!l){r("Please select a loyalty card");return}d(!0),r(null),g.get("/business/issue-stamp",{loyalty_card_id:l}),d(!1)},p=async()=>{u(!0),r(null);try{const s=await fetch(`/business/issue-stamps/generate-offline?id=${l}`,{method:"GET",headers:{Accept:"application/pdf"}});if(!s.ok)throw new Error("Failed to generate offline stamps");const C=await s.blob(),b=window.URL.createObjectURL(C),a=document.createElement("a");a.href=b,a.download=`loyalty-stamps-${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(b),document.body.removeChild(a)}catch(s){r("Failed to download offline stamps. Please try again."),console.error("Download error:",s)}finally{u(!1)}};return e.jsxs(L,{children:[e.jsx(S,{title:"Issue Stamp"}),e.jsxs("div",{className:"w-full max-w-2xl mx-auto sm:mt-6 md:mt-8 sm:px-6 lg:px-8",children:[o.success?e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 sm:p-8",children:[e.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[e.jsx("div",{className:"inline-block p-2 bg-green-100 rounded-full mb-3 sm:mb-4",children:e.jsx("svg",{className:"w-6 h-6 sm:w-8 sm:h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-900 mb-1",children:"Code Generated Successfully"}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500",children:["Generated on ",o.created_at]})]}),e.jsxs("div",{className:"border-t border-b border-gray-200 py-4 sm:py-6 mb-4 sm:mb-6",children:[e.jsx("div",{className:"flex justify-center mb-4 sm:mb-6",children:e.jsx("img",{src:o.qr_url,alt:"QR Code",className:"w-48 h-48 sm:w-56 sm:h-56 md:w-64 md:h-64 border-2 border-gray-200 rounded-lg"})}),e.jsxs("div",{className:"text-center px-2",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-2",children:"Or enter code manually:"}),e.jsx("div",{className:"inline-block bg-gray-100 px-4 sm:px-6 py-2 sm:py-3 rounded-lg",children:e.jsx("p",{className:"text-xl sm:text-2xl md:text-3xl font-mono font-bold text-gray-900 tracking-wider break-all",children:o.code})})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 sm:p-4 mb-4 sm:mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-2 sm:mr-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-yellow-800",children:"Important"}),e.jsx("p",{className:"text-xs sm:text-sm text-yellow-700 mt-1",children:"This code will expire in 15 minutes if not used. Customer must scan or enter the code in their app."})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"loyalty-card-new",className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Loyalty Card for New Code"}),e.jsxs(j,{value:l,onValueChange:x,children:[e.jsx(f,{className:"w-full",children:e.jsx(w,{placeholder:"Select a loyalty card"})}),e.jsx(y,{children:t.map(s=>e.jsx(v,{value:s.id.toString(),children:s.name},s.id))})]})]}),m&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-sm",children:m}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:k,className:"w-full px-4 sm:px-6 py-2.5 sm:py-3 bg-accent text-white text-sm sm:text-base font-medium rounded-lg hover:bg-accent/70 transition-colors",children:"Generate New Code"}),e.jsx("button",{onClick:p,disabled:c,className:"w-full px-4 sm:px-6 py-2.5 sm:py-3 bg-blue-600 text-white text-sm sm:text-base font-medium rounded-lg hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Generating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{children:"Download Offline Stamps"})]})})]})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 sm:p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"mb-4 sm:mb-6",children:e.jsx("svg",{className:"w-16 h-16 sm:w-20 sm:h-20 mx-auto text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-900 mb-2",children:"Ready to Issue a Stamp?"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mb-6 px-2",children:"Select a loyalty card and generate a unique code for your customer."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"loyalty-card",className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Loyalty Card"}),t.length>0?e.jsxs(j,{value:l,onValueChange:x,children:[e.jsx(f,{className:"w-full",children:e.jsx(w,{placeholder:"Select a loyalty card"})}),e.jsx(y,{children:t.map(s=>e.jsx(v,{value:s.id.toString(),children:s.name},s.id))})]}):e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-700 text-sm",children:"No loyalty cards available. Please create a loyalty card first."})]}),m&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-sm",children:m}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:N,disabled:h||t.length===0,className:"w-full px-6 py-3 bg-accent text-white font-medium rounded-lg hover:bg-accent/70 disabled:bg-accent/60 disabled:cursor-not-allowed transition-colors",children:h?"Generating...":"Generate Code"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or"})})]}),e.jsx("button",{onClick:p,disabled:c||t.length===0,className:"w-full px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Generating Offline Stamps..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{children:"Download Offline Stamps (8 tickets)"})]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-xs text-blue-700",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("svg",{className:"w-4 h-4 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsx("p",{children:"Offline stamps are perfect for events or areas without internet. Print 8 tickets at once and distribute to customers."})]})})]})]}),e.jsx("div",{className:"mt-4 sm:mt-6 text-center text-xs sm:text-sm text-gray-500 px-2",children:e.jsx("p",{children:"Customer should open their app and scan the QR code or enter the code manually."})})]})]})}export{q as default};
